---
# Preamble

## Author
author:
  name: Мишина Анастасия Алексеевна
  orcid: 0009-0002-6246-7100
  email: 1132226532@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Отчет по лабораторной работе №5"
subtitle: "Дисциплина: Моделирование сетей передачи данных"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Основной целью работы является получение навыков проведения интерактивных экспериментов в среде Mininet по исследованию параметров сети, связанных с потерей, дублированием, изменением порядка и повреждением пакетов при передаче данных. Эти параметры влияют на производительность протоколов и сетей.

# Задание

1. Задайте простейшую топологию, состоящую из двух хостов и коммутатора с назначенной по умолчанию mininet сетью 10.0.0.0/8.
2. Проведите интерактивные эксперименты по по исследованию параметров сети, связанных с потерей, дублированием, изменением порядка и повреждением пакетов при передаче данных.
3. Реализуйте воспроизводимый эксперимент по добавлению правила отбрасывания пакетов в эмулируемой глобальной сети. На экран выведите сводную информацию о потерянных пакетах.
4. Самостоятельно реализуйте воспроизводимые эксперименты по исследованию параметров сети, связанных с потерей, изменением порядка и повреждением пакетов при передаче данных. На экран выведите сводную информацию о потерянных пакетах.

# Теоретическое введение

Mininet[@mininet] -- это эмулятор компьютерной сети. Под компьютерной сетью подразумеваются простые компьютеры — хосты, коммутаторы, а так же OpenFlow-контроллеры. С помощью простейшего синтаксиса в примитивном интерпретаторе команд можно разворачивать сети из произвольного количества хостов, коммутаторов в различных топологиях и все это в рамках одной виртуальной машины(ВМ). На всех хостах можно изменять сетевую конфигурацию, пользоваться стандартными утилитами(ifconfig, ping) и даже получать доступ к терминалу. На коммутаторы можно добавлять различные правила и маршрутизировать трафик.

# Выполнение лабораторной работы

## Запуск лабораторной топологии

Запустим виртуальную среду с mininet. Из основной ОС подключимся к виртуальной машине. В виртуальной машине mininet при необходимости исправим права запуска X-соединения. Скопируем значение куки (MIT magic cookie) своего пользователя mininet в файл для пользователя root.

Зададим простейшую топологию, состоящую из двух хостов и коммутатора с назначенной по умолчанию mininet сетью 10.0.0.0/8. На хостах h1 и h2 введем команду ifconfig, чтобы отобразить информацию, относящуюся к их сетевым интерфейсам и назначенным им IP-адресам. В дальнейшем при работе с NETEM и командой tc будут использоваться интерфейсы h1-eth0 и h2-eth0 ([рис. @fig-001]).

![ifconfig на хостах h1 и h2](image/1.png){#fig-001 width=70%} 

Проверим подключение между хостами h1 и h2 с помощью команды ping с параметром -c 6 ([рис. @fig-002]).

![Проверка подключения между хостами](image/2.png){#fig-002 width=70%}

## Интерактивные эксперименты

### Добавление потери пакетов на интерфейс, подключённый к эмулируемой глобальной сети

Пакеты могут быть потеряны в процессе передачи из-за таких факторов, как битовые ошибки и перегрузка сети. Скорость потери данных часто измеряется как процентная доля потерянных пакетов по отношению к количеству отправленных пакетов.

1. На хосте h1 добавим 10% потерь пакетов к интерфейсу h1-eth0: `sudo tc qdisc add dev h1-eth0 root netem loss 10%` ([рис. @fig-003]).

![Добавим 10% потерь пакетов к интерфейсу h1-eth0](image/3.png){#fig-003 width=70%}

Здесь:
- sudo: выполнить команду с более высокими привилегиями;
- tc: вызвать управление трафиком Linux;
- qdisc: изменить дисциплину очередей сетевого планировщика;
- add: создать новое правило;
- dev h1-eth0: указать интерфейс, на котором будет применяться правило;
- netem: использовать эмулятор сети;
- loss 10%: 10% потерь пакетов.

2. Проверьте, что на соединении от хоста h1 к хосту h2 имеются потери пакетов, используя команду ping с параметром -c 100 с хоста h1. Параметр -c указывает общее количество пакетов для отправки. Обратите внимание на значения icmp_seq Некоторые номера последовательности отсутствуют из-за потери пакетов. В сводном отчёте ping сообщает о проценте потерянных пакетов после завершения передачи ([рис. @fig-004]). Передано 100 пакетов, пришло 86 пакетов, 14% потеря пакетов.

![Проверка потери пакетов](image/4.png){#fig-004 width=70%}

3. Для эмуляции глобальной сети с потерей пакетов в обоих направлениях необходимо к соответствующему интерфейсу на хосте h2 также добавить 10% потерь пакетов: `sudo tc qdisc add dev h2-eth0 root netem loss 10%` ([рис. @fig-005]).

![Добавим 10% потерь пакетов к интерфейсу h2-eth0](image/5.png){#fig-005 width=70%}

4. Проверьте, что соединение между хостом h1 и хостом h2 имеет больший процент потерянных данных (10% от хоста h1 к хосту h2 и 10% от хоста h2 к хосту h1), повторив команду pingс параметром -c 100 на терминале хоста h1. Потери пакетов 84/100, процент потерянных пакетов после завершения передачи 16% ([рис. @fig-006]). Номера потерянных пакетов (значения icmp_seq) 11, 20, ..., 90.

![Проверка потери пакетов](image/6.png){#fig-006 width=70%}

5. Восстановите конфигурацию по умолчанию, удалив все правила, применённые к сетевому планировщику соответствующего интерфейса. Для отправителя h1: `sudo tc qdisc del dev h1-eth0 root netem`. Для получателя h2: `sudo tc qdisc del dev h2-eth0 root netem` ([рис. @fig-007]).

![Восстановление конфигурации по умолчанию](image/7.png){#fig-007 width=70%}

6. Убедитесь, что соединение от хоста h1 к хосту h2 не имеет явной потери пакетов, запустив команду ping с терминала хоста h1 и затем нажав Ctrl + c, чтобы остановить тест.

### Добавление значения корреляции для потери пакетов в эмулируемой глобальной сети

1. Добавьте на интерфейсе узла h1 коэффициент потери пакетов 50% (такой высокий уровень потери пакетов маловероятен), и каждая последующая вероятность зависит на 50% от последней: `sudo tc qdisc add dev h1-eth0 root netem loss 50% 50%` ([рис. @fig-008]).

![Добавим коэффициент потери пакетов 50% на интерфейсе узла h1](image/8.png){#fig-008 width=70%}

2. Проверьте, что на соединении от хоста h1 к хосту h2 имеются потери пакетов, используя команду ping с параметром -c 50 с хоста h1 ([рис. @fig-009]). Отсутствующие из-за потери пакетов номера последовательности (icmp_seq) 1-4, 7, 10, 21, 27, 28, 30, ..., 49. Процент потерянных пакетов после завершения передачи - 34%.

![Проверка потери пакетов](image/9.png){#fig-009 width=70%}

3. Восстановите для узла h1 конфигурацию по умолчанию, удалив все правила применённые к сетевому планировщику соответствующего интерфейса: `sudo tc qdisc del dev h1-eth0 root netem`.

### Добавление повреждения пакетов в эмулируемой глобальной сети

1. При необходимости восстановите конфигурацию интерфейсов по умолчанию на узлах h1 и h2.
2. Добавьте на интерфейсе узла h1 0,01% повреждения пакетов: `sudo tc qdisc add dev h1-eth0 root netem corrupt 0.01%` ([рис. @fig-010]).

![Добавим на интерфейсе узла h1 0,01% повреждения пакетов](image/10.png){#fig-010 width=70%}

3. Проверьте конфигурацию с помощью инструмента iPerf3 для проверки повторных передач. Для этого:

- запустите iPerf3 в режиме сервера в терминале хоста h2: `iperf3 -s` ([рис. @fig-011]).

![iperf3 в режиме сервера в терминале хоста h2](image/11.png){#fig-011 width=70%}

- запустите iPerf3 в клиентском режиме в терминале хоста h1: `iperf3 -c 10.0.0.2`.
- Общее количество повторно переданных пакетов - 22 пакета.
- Для остановки сервера iPerf3 нажмите Ctrl + c в терминале хоста h2.

4. Восстановите для узла h1 конфигурацию по умолчанию, удалив все правила, применённые к сетевому планировщику соответствующего интерфейса.

### Добавление переупорядочивания пакетов в интерфейс подключения к эмулируемой глобальной сети

1. При необходимости восстановите конфигурацию интерфейсов по умолчанию на узлах h1 и h2.
2. Добавьте на интерфейсе узла h1 следующее правило: `sudo tc qdisc add dev h1-eth0 root netem delay 10ms reorder 25% 50%`. Здесь 25% пакетов (со значением корреляции 50%) будут отправлены немедленно, а остальные 75% будут задержанына 10 мс.

3. Проверьте, что на соединении от хоста h1 к хосту h2 имеются потери пакетов, используя команду ping с параметром -c 20 с хоста h1. Убедитесь, что часть пакетов не будут иметь задержки (один из четырех, или 25%), а последующие несколько пакетов будут иметь задержку около 10 миллисекунд (три изчетырех, или 75%). При необходимости повторите тест. Укажите в отчёте отсутствующие из-за потери пакетов номера последовательности (значения icmp_seq), процент потерянных пакетов после завершения передачи ([рис. @fig-012]).

![Добавим на интерфейсе узла h1 переупорядочивание пакетов. Проверка потери пакетов](image/12.png){#fig-012 width=70%}

4. Восстановите конфигурацию интерфейса по умолчанию на узле h1.

### Добавление дублирования пакетов в интерфейс подключения к эмулируемой глобальной сети

1. При необходимости восстановите конфигурацию интерфейсов по умолчанию на узлах h1 и h2.
2. Для интерфейса узла h1 задайте правило c дублированием 50% пакетов (т.е. 50% пакетов должны быть получены дважды): `sudo tc qdisc add dev h1-eth0 root netem duplicate 50%` ([рис. @fig-013]).

![Добавим на интерфейсе узла h1 правило с дублированием 50% пакетов. Проверка потери пакетов](image/13.png){#fig-013 width=70%}

3. Проверьте, что на соединении от хоста h1 к хосту h2 имеются дублированные пакеты, используя команду ping с параметром -c 20 с хоста h1. Дубликаты пакетов помечаются как DUP!. Измеренная скорость дублирования пакетов будет приближаться к настроенной скорости по мере выполнения большего количества попыток.

4. Восстановите конфигурацию интерфейса по умолчанию на узле h1.

## Воспроизведение экспериментов

### Предварительная подготовка

1. Для каждого воспроизводимого эксперимента expname создайте свой каталог, в котором будут размещаться файлы эксперимента: `mkdir -p ~/work/lab_netem_ii/expname`. Здесь expname может принимать значения simple-drop, correlation-
drop и т.п.
2. Для каждого случая создайте скрипт для проведения эксперимента `lab_netem_ii.py`.

### Добавление потери пакетов на интерфейс, подключённый к эмулируемой глобальной сети

С помощью API Mininet воспроизведите эксперимент по добавлению потери пакетов для интерфейса хоста, подключающегося к эмулируемой глобальной сети.

1. В виртуальной среде mininet в своём рабочем каталоге с проектами создайте каталог simple-drop и перейдите в него: `mkdir -p ~/work/lab_netem_ii/simple-drop`, `cd ~/work/lab_netem_ii/simple-drop`.
2. Создаёте скрипт для эксперимента `lab_netem_ii.py`:

```python
#!/usr/bin/env python
"""
Simple experiment.
Output: ping.dat
"""
from mininet.net import Mininet
from mininet.node import Controller
from mininet.cli import CLI
from mininet.log import setLogLevel, info
import time

def emptyNet():
  "Create an empty network and add nodes to it."
  net = Mininet( controller=Controller, waitConnected=True )

  info( '*** Adding controller\n' )
  net.addController( 'c0' )
  info( '*** Adding hosts\n' )
  h1 = net.addHost( 'h1', ip='10.0.0.1' )
  h2 = net.addHost( 'h2', ip='10.0.0.2' )
  info( '*** Adding switch\n' )
  s1 = net.addSwitch( 's1' )
  info( '*** Creating links\n' )
  net.addLink( h1, s1 )
  net.addLink( h2, s1 )
  info( '*** Starting network\n')
  net.start()
  info( '*** Set delay\n')
  # Задается значение потери пакетов для интерфейса хоста
  h1.cmdPrint( 'tc qdisc add dev h1-eth0 root netem loss 10%' )
  h2.cmdPrint( 'tc qdisc add dev h2-eth0 root netem loss 10%' )

  time.sleep(10) # Wait 10 seconds
  info( '*** Ping\n')
  h1.cmdPrint( 'ping -c 100', h2.IP(), '| grep "time=" | awk \'{print $5, $7}\' | sed -e \'s/time=//g\' -e \'s/icmp_seq=//g\' > ping.dat' )

  info( '*** Stopping network' )
  net.stop()

if __name__ == '__main__':
  setLogLevel( 'info' )
  emptyNet()
```

3. Скорректируйте скрипт так, чтобы на экран или в отдельный файл выводилась информация о потерях пакетов ([рис. @fig-014]).

![Вывод информации о потерях пакетов](image/14.png){#fig-014 width=70%}

4. Создайте Makefile для управления процессом проведения эксперимента ([рис. @fig-015]):

```Makefile
all:
  ping.dat

ping.dat:
  sudo python lab_netem_ii.py
  sudo chown mininet:mininet ping.dat

clean:
  -rm -f *.dat
```

![Makefile](image/15.png){#fig-015 width=70%}


5. Выполните эксперимент: `make` ([рис. @fig-016]).

![Выполнение эксперимента. Просмотр информации о потерях пакетов](image/16.png){#fig-016 width=70%}

6. Очистите каталог от результатов проведения экспериментов: `make clean`.

## Задание для самостоятельной работы

Самостоятельно реализуйте воспроизводимые эксперименты по исследованию параметров сети, связанных с потерей, изменением порядка и повреждением пакетов при передаче данных.

### Добавление значения корреляции для потери пакетов

Добавим значение корреляции для потери пакетов на интерфейсе хоста h1 с коэффициентом 50% ([рис. @fig-017]).

![Добавим коэффициент потери пакетов 50% на интерфейсе узла h1](image/17.png){#fig-017 width=70%}

Выполним эксперимент и посмотрим информацию о потерях пакетов ([рис. @fig-018]).

![Выполнение эксперимента. Просмотр информации о потерях пакетов](image/18.png){#fig-018 width=70%}

### Добавление повреждения пакетов

Добавим на интерфейсе узла h1 0,01% повреждения пакетов ([рис. @fig-019]).

![Добавим на интерфейсе узла h1 0,01% повреждения пакетов](image/19.png){#fig-019 width=70%}

Выполним эксперимент и посмотрим информацию о потерях пакетов ([рис. @fig-020]).

![Выполнение эксперимента. Просмотр информации о потерях пакетов](image/20.png){#fig-020 width=70%}

### Добавление переупорядочивания пакетов в интерфейс подключения

Добавим на интерфейсе узла h1 следующее правило: `sudo tc qdisc add dev h1-eth0 root netem delay 10ms reorder 25% 50%` ([рис. @fig-021]).

![Добавление переупорядочивания пакетов на интерфейсе узла h1](image/21.png){#fig-021 width=70%}

Выполним эксперимент и посмотрим информацию о потерях пакетов ([рис. @fig-022]).

![Выполнение эксперимента. Просмотр информации о потерях пакетов](image/22.png){#fig-022 width=70%}

### Добавление дублирования пакетов в интерфейс подключения

Для интерфейса узла h1 зададим правило c дублированием 50% пакетов (т.е. 50% пакетов должны быть получены дважды) ([рис. @fig-023]).

![Добавим на интерфейсе узла h1 правило с дублированием 50% пакетов](image/23.png){#fig-023 width=70%}

Выполним эксперимент и посмотрим информацию о потерях пакетов ([рис. @fig-024]).

![Выполнение эксперимента. Просмотр информации о потерях пакетов](image/24.png){#fig-024 width=70%}

# Выводы

В результате выполнения данной лабораторной работы я получила навыки проведения интерактивных экспериментов в среде Mininet по исследованию параметров сети, связанных с потерей, дублированием, изменением порядка и повреждением пакетов при передаче данных.

# Список литературы{.unnumbered}

::: {#refs}
:::